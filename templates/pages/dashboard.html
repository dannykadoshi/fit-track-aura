{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - FitTrack{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Welcome Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center flex-wrap">
                <div class="mb-3 mb-md-0">
                    <h1 class="display-5 fw-bold text-white">Welcome back, {{ user.username }}! ğŸ‘‹</h1>
                    <p class="text-muted">Here's your fitness summary for today</p>
                </div>
                <div class="badge badge-custom">
                    <span style="font-size: 1.5rem;">
                        {% if current_streak > 0 %}ğŸ”¥{% else %}ğŸ“…{% endif %}
                    </span>
                    <div class="ms-2">
                        <div class="fw-bold">{{ current_streak }} {% if current_streak == 1 %}Day{% else %}Days{% endif %}</div>
                        <small>Current Streak</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Best Streak Achievement Badge -->
    {% if best_streak >= 3 %}
    <div class="alert alert-warning mb-4" role="alert">
        <div class="d-flex align-items-center">
            <div class="fs-2 me-3">
                {% if best_streak >= 30 %}
                    ğŸ…
                {% elif best_streak >= 14 %}
                    ğŸ¥‡
                {% elif best_streak >= 7 %}
                    ğŸ¥ˆ
                {% else %}
                    ğŸ¥‰
                {% endif %}
            </div>
            <div>
                <h5 class="alert-heading mb-1">Achievement Unlocked!</h5>
                <p class="mb-0">
                    Your best streak is <strong>{{ best_streak }} days</strong>! 
                    {% if best_streak >= 30 %}
                        You're a fitness legend! ğŸ”¥
                    {% elif best_streak >= 14 %}
                        Two weeks strong! Keep going! ğŸ’ª
                    {% elif best_streak >= 7 %}
                        One week streak! Awesome! â­
                    {% else %}
                        Great start! Keep building! ğŸ¯
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Stats Overview -->
    <div class="dashboard-grid mb-5">
        <!-- Stat 1 - Workouts This Month -->
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="stat-icon">ğŸ‹ï¸</div>
                <span class="text-success fw-semibold">This Month</span>
            </div>
            <h3 class="fw-bold mb-1">{{ workouts_this_month }}</h3>
            <p class="text-muted mb-0">Workouts Logged</p>
        </div>

        <!-- Stat 2 - Current Streak -->
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    {% if current_streak >= 7 %}
                        ğŸ†
                    {% elif current_streak >= 3 %}
                        â­
                    {% else %}
                        ğŸ”¥
                    {% endif %}
                </div>
                <span class="{% if current_streak > 0 %}text-success{% else %}text-muted{% endif %} fw-semibold">
                    {% if current_streak == 0 %}
                        Start Today!
                    {% elif current_streak >= 7 %}
                        On Fire!
                    {% else %}
                        Keep Going!
                    {% endif %}
                </span>
            </div>
            <h3 class="fw-bold mb-1">{{ current_streak }} {% if current_streak == 1 %}Day{% else %}Days{% endif %}</h3>
            <p class="text-muted mb-0">Current Streak</p>
        </div>

        <!-- Stat 3 - Total Training Time -->
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #059669);">â±ï¸</div>
                <span class="text-success fw-semibold">This Month</span>
            </div>
            <h3 class="fw-bold mb-1">{{ total_time }}</h3>
            <p class="text-muted mb-0">Minutes Trained</p>
        </div>

        <!-- Stat 4 - Goals Progress -->
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #dc2626);">ğŸ¯</div>
                <span class="text-warning fw-semibold">{{ active_goals.count }} Active</span>
            </div>
            <h3 class="fw-bold mb-1">{{ goals_progress }}%</h3>
            <p class="text-muted mb-0">Goals Progress</p>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="row g-4">
        <!-- Recent Workouts -->
        <div class="col-lg-8">
            <div class="card-custom p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3 class="fw-bold mb-0">Recent Workouts</h3>
                    <a href="{% url 'workout_create' %}" class="btn btn-sm btn-gradient-purple">
                        <span>â•</span> Log Workout
                    </a>
                </div>

                {% if recent_workouts %}
                    <div class="space-y-3">
                        {% for workout in recent_workouts %}
                            <div class="workout-card">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="d-flex align-items-start gap-3">
                                        <div class="stat-icon" style="width: 40px; height: 40px; font-size: 1.2rem;">
                                            ğŸ‹ï¸
                                        </div>
                                        <div>
                                            <h5 class="fw-semibold text-white mb-1">{{ workout.title }}</h5>
                                            <p class="text-muted mb-0 small">
                                                {{ workout.date|date:"M d, Y" }} â€¢ 
                                                {% if workout.duration %}{{ workout.duration }} min{% endif %}
                                                {% if workout.total_exercises %} â€¢ {{ workout.total_exercises }} exercises{% endif %}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <a href="{% url 'workout_update' workout.pk %}" class="btn btn-sm btn-outline-light">Edit</a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <div class="stat-icon mx-auto mb-3" style="width: 64px; height: 64px; font-size: 2rem;">ğŸ‹ï¸</div>
                        <h5 class="text-white mb-2">No workouts yet</h5>
                        <p class="text-muted mb-4">Start tracking your fitness journey today!</p>
                        <a href="{% url 'workout_create' %}" class="btn btn-gradient-purple">Log Your First Workout</a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Active Goals -->
        <div class="col-lg-4">
            <div class="card-custom p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3 class="fw-bold mb-0">Active Goals</h3>
                    <a href="{% url 'goal_list' %}" class="text-purple-400 text-decoration-none small fw-semibold">Manage â†’</a>
                </div>

                {% if active_goals %}
                    <div class="space-y-3">
                        {% for goal in active_goals %}
                            <div class="card-custom p-3">
                                <div class="d-flex align-items-start justify-content-between mb-2">
                                    <div class="flex-grow-1">
                                        <div class="d-flex align-items-center gap-2 mb-2">
                                            <span style="color: var(--purple-500);">
                                                {% if goal.is_completed %}âœ…{% else %}â­•{% endif %}
                                            </span>
                                            <h6 class="fw-semibold text-white mb-0 small">{{ goal.title }}</h6>
                                        </div>
                                        <p class="text-muted mb-2 small">
                                            {{ goal.current_value }} / {{ goal.target_value }} â€¢ 
                                            Due {{ goal.target_date|date:"M d" }}
                                        </p>
                                    </div>
                                    <span class="text-success fw-bold">{{ goal.progress }}%</span>
                                </div>
                                <div class="progress-custom">
                                    <div class="progress-bar-custom" style="width: {{ goal.progress }}%;"></div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <div class="stat-icon mx-auto mb-3" style="width: 48px; height: 48px;">ğŸ¯</div>
                        <h6 class="text-white mb-2">No goals set</h6>
                        <p class="text-muted small mb-3">Set goals to stay motivated!</p>
                        <a href="{% url 'goal_create' %}" class="btn btn-sm btn-gradient-purple">Create Goal</a>
                    </div>
                {% endif %}
            </div>

            <!-- Streak Stats -->
            <div class="card-custom p-4 mt-4">
                <h5 class="fw-bold mb-3">Streak Stats</h5>
                <div class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom border-secondary">
                    <span class="text-muted">Current Streak</span>
                    <span class="fw-bold text-white">{{ current_streak }} days ğŸ”¥</span>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom border-secondary">
                    <span class="text-muted">Best Streak</span>
                    <span class="fw-bold text-white">{{ best_streak }} days ğŸ†</span>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="text-muted">Total Workouts</span>
                    <span class="fw-bold text-white">{{ workouts_count }}</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}